<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MackiesPhoneApp.Pages.User.OrderPage"
             xmlns:local="clr-namespace:MackiesPhoneApp.Services"
             x:Name="OrderPageRoot"
            Title="">

    <ScrollView>
    <StackLayout Padding="10" BackgroundColor="{AppThemeBinding Light={StaticResource AppToolbarBackgroundColorLight}, Dark={StaticResource AppToolbarBackgroundColorDark}}" >


        
        
            <CollectionView x:Name="FiltersView"
                  ItemsSource="{Binding ProductFilters}"
                  SelectionMode="Multiple"
                  SelectionChanged="OnFilterSelected">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="10"
                     Margin="5"
                     InputTransparent="True"
                     BorderColor="LightGray"
                     BackgroundColor="LightBlue"
                     HasShadow="False">
                            <Label Text="{Binding}"
                         FontSize="18"
                         TextColor="Black" />
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        
        


            <CollectionView x:Name="ProductCategoriesView"
                            IsVisible="{Binding ShowProductCategories}"
                            ItemsSource="{Binding ProductCategories}"
                            SelectionMode="Single"
                            SelectionChanged="OnCategorySelected">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="10"
                               Margin="5"
                               InputTransparent="True"
                               BorderColor="LightGray"
                               BackgroundColor="LightBlue"
                               HasShadow="False">
                            <Label Text="{Binding CategoryName}"
                                   FontSize="18"
                                   TextColor="Black" />
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <CollectionView x:Name="ProductTypesView"
                IsVisible="{Binding ShowProductTypes}"
                ItemsSource="{Binding ProductTypes}"
                SelectionMode="Single"
                SelectionChanged="OnTypeSelected">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="10"
                   Margin="5"
                   InputTransparent="True"
                   BorderColor="LightGray"
                   BackgroundColor="LightBlue"
                   HasShadow="False">
                            <Label Text="{Binding CategoryName}"
                       FontSize="18"
                       TextColor="Black" />
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>




            <CollectionView x:Name="OrderItemsCollectionView"              
            SelectionMode="None"
            >
        <CollectionView.ItemTemplate Margin="20">
            <DataTemplate>
                    <Frame CornerRadius="5"  Padding="10" Margin="2" BackgroundColor="{AppThemeBinding Light={StaticResource ViewItemBorderColorLight}, Dark={StaticResource ViewItemBorderColorDark}}" >
                        <Frame Padding="0" Margin="0" CornerRadius="8" BackgroundColor="{AppThemeBinding Light={StaticResource ViewItemBackgroundColorLight}, Dark={StaticResource ViewItemBackgroundColorDark}}">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnOrderItemTapped" />
                            </Frame.GestureRecognizers>

                            <Grid HorizontalOptions="FillAndExpand" ColumnSpacing="10" >
                                <Grid.ColumnDefinitions>
                                    <!-- Image column -->
                                    <ColumnDefinition Width="Auto" />
                                    <!-- Content column fills the rest -->
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- Left image -->
                                <Image Grid.Column="0"
                            Source="{Binding imageurl}" 
                            WidthRequest="120" 
                            HeightRequest="120"  
                            Aspect="AspectFill"  
                            VerticalOptions="Center" />

                                <!-- Labels stacked vertically to the right of image -->
                                <VerticalStackLayout Grid.Column="1"
                         VerticalOptions="Center"
                         Spacing="2">
                                    <Label Text="{Binding pizzanumber}" 
                                FontSize="16" 
                                TextColor="white" />
                                    <Label Text="{Binding productname}" 
                                FontSize="16"  
                                TextColor="white" />
                                    <Label Text="{Binding productdescription}" 
                                FontSize="16" 
                                TextColor="white" />
                                    <Label Text="{Binding unitprice, StringFormat='{0:C}/stk.'}" 
                                FontSize="14"  
                                TextColor="white" />

                                    <HorizontalStackLayout Grid.Column="0" Spacing="8">
                                        <Image 
                                    IsVisible="{Binding IsQuantityEditable}"
                                    BackgroundColor="Transparent"                                             
                                    Source="minussign.png"
                                    WidthRequest="20" 
                                    InputTransparent="False">
                                            <Image.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnImageMinusTapped" />
                                            </Image.GestureRecognizers>
                                        </Image>
                                        <Label 
                                IsVisible="{Binding IsQuantityVisible}" 
                                Text="{Binding quantity,  StringFormat='{0} stk.'}" 
                                FontSize="14" 
                                VerticalOptions="Center" 
                                TextColor="white" />
                                        <Image 
                                    BackgroundColor="Transparent"
                                    IsVisible="{Binding IsQuantityEditable}"
                                    Source="plussign.png"
                                    WidthRequest="20"
                                    HeightRequest="20">
                                            <Image.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnImagePlusTapped" />
                                            </Image.GestureRecognizers>
                                        </Image>
                                        <Button 
                                    IsVisible="{Binding IsQuantityEditable}"
                                    BackgroundColor="white" 
                                    TextColor="black" 
                                    Text="Put i kurven" Clicked="OnAddToBasketClicked" />


                                        <Image 
                                    BackgroundColor="Transparent"
                                    IsVisible="{Binding IsInBasket}" 
                                    Source="shoppingbasket.png"
                                    WidthRequest="40"
                                    HeightRequest="40">
                                            <Image.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnImagePlusTapped" />
                                            </Image.GestureRecognizers>
                                        </Image>


                                    </HorizontalStackLayout>
                                    <Label
                                Text="{Binding LineTotal,  StringFormat='ialt: {0} kr.'}" 
                                IsVisible="{Binding IsInBasket}" 
                                 HorizontalOptions="End"
                                FontSize="15" 
                                VerticalOptions="Center"  
                                TextColor="white" />
                                    <Label 
                                    Text="Se detaljer"
                                    TextColor="White"
                                FontSize="16">
                                        <Label.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnDetailsTapped" />
                                        </Label.GestureRecognizers>
                                    </Label>
                                </VerticalStackLayout>


                            </Grid>
                        </Frame>
                    </Frame>
                </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>
    </StackLayout>
        </ScrollView>
</ContentPage>